var Pe=Object.defineProperty;var ke=(e,t,r)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var he=(e,t,r)=>ke(e,typeof t!="symbol"?t+"":t,r);import{aj as Ee,ak as Be,al as Ve,am as fe,ag as R,an as Ae,O as K,ao as de,ap as Re,aq as ze,q as Le,ar as Fe,_ as le,Z as Ge,a3 as G,z as ne,N as pe,a0 as $e,B as Ue,D as Xe,J as Ye,K as _e,as as je,at as qe,au as He,av as Ze,aw as De,ax as Je,F as We,ay as me,ac as Ne,az as Ke,aA as Qe,aB as et,S as tt,aC as at,r as rt,aD as nt,g as it,e as _,c as lt,d as st,f as ot,u as gt}from"./useDesign-jPeGL5oW.js";import{T as ct,s as ut}from"./index-DAtyrCpe.js";import{g as Q}from"./sectorHelper-CBBKUufA.js";import{c as vt}from"./createSeriesDataSimply-DS91XHSt.js";import{d as ht,c as ft,r as dt,h as pt,b as mt,e as yt,f as bt,i as ye,j as St,n as be,u as wt,_ as At}from"./index-PWaRPkkw.js";import{w as Lt}from"./withInstall-Df4KX8Pz.js";var Se=Math.PI*2,ee=Math.PI/180;function xe(e,t){return Ve(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function Me(e,t){var r=xe(e,t),a=e.get("center"),i=e.get("radius");fe(i)||(i=[0,i]);var l=R(r.width,t.getWidth()),n=R(r.height,t.getHeight()),g=Math.min(l,n),u=R(i[0],g/2),d=R(i[1],g/2),c,p,v=e.coordinateSystem;if(v){var s=v.dataToPoint(a);c=s[0]||0,p=s[1]||0}else fe(a)||(a=[a,a]),c=R(a[0],l)+r.x,p=R(a[1],n)+r.y;return{cx:c,cy:p,r0:u,r:d}}function Dt(e,t,r){t.eachSeriesByType(e,function(a){var i=a.getData(),l=i.mapDimension("value"),n=xe(a,r),g=Me(a,r),u=g.cx,d=g.cy,c=g.r,p=g.r0,v=-a.get("startAngle")*ee,s=a.get("endAngle"),o=a.get("padAngle")*ee;s=s==="auto"?v-Se:-s*ee;var h=a.get("minAngle")*ee,f=h+o,y=0;i.each(l,function(k){!isNaN(k)&&y++});var S=i.getSum(l),b=Math.PI/(S||y)*2,N=a.get("clockwise"),L=a.get("roseType"),x=a.get("stillShowZeroSum"),C=i.getDataExtent(l);C[0]=0;var m=N?1:-1,w=[v,s],O=m*o/2;Ee(w,!N),v=w[0],s=w[1];var z=Te(a);z.startAngle=v,z.endAngle=s,z.clockwise=N;var B=Math.abs(s-v),E=B,$=0,P=v;if(i.setLayout({viewRect:n,r:c}),i.each(l,function(k,I){var A;if(isNaN(k)){i.setItemLayout(I,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:N,cx:u,cy:d,r0:p,r:L?NaN:c});return}L!=="area"?A=S===0&&x?b:k*b:A=B/y,A<f?(A=f,E-=f):$+=k;var T=P+m*A,M=0,D=0;o>A?(M=P+m*A/2,D=M):(M=P+O,D=T-O),i.setItemLayout(I,{angle:A,startAngle:M,endAngle:D,clockwise:N,cx:u,cy:d,r0:p,r:L?Be(k,C,[p,c]):c}),P=T}),E<Se&&y)if(E<=.001){var V=B/y;i.each(l,function(k,I){if(!isNaN(k)){var A=i.getItemLayout(I);A.angle=V;var T=0,M=0;V<o?(T=v+m*(I+1/2)*V,M=T):(T=v+m*I*V+O,M=v+m*(I+1)*V-O),A.startAngle=T,A.endAngle=M}})}else b=E/$,P=v,i.each(l,function(k,I){if(!isNaN(k)){var A=i.getItemLayout(I),T=A.angle===f?f:k*b,M=0,D=0;T<o?(M=P+m*T/2,D=M):(M=P+O,D=P+m*T-O),A.startAngle=M,A.endAngle=D,P+=m*T}})})}var Te=Ae();function Nt(e){return{seriesType:e,reset:function(t,r){var a=r.findComponents({mainType:"legend"});if(!(!a||!a.length)){var i=t.getData();i.filterSelf(function(l){for(var n=i.getName(l),g=0;g<a.length;g++)if(!a[g].isSelected(n))return!1;return!0})}}}}var xt=Math.PI/180;function we(e,t,r,a,i,l,n,g,u,d){if(e.length<2)return;function c(h){for(var f=h.rB,y=f*f,S=0;S<h.list.length;S++){var b=h.list[S],N=Math.abs(b.label.y-r),L=a+b.len,x=L*L,C=Math.sqrt((1-Math.abs(N*N/y))*x),m=t+(C+b.len2)*i,w=m-b.label.x,O=b.targetTextWidth-w*i;Ce(b,O,!0),b.label.x=m}}function p(h){for(var f={list:[],maxY:0},y={list:[],maxY:0},S=0;S<h.length;S++)if(h[S].labelAlignTo==="none"){var b=h[S],N=b.label.y>r?y:f,L=Math.abs(b.label.y-r);if(L>=N.maxY){var x=b.label.x-t-b.len2*i,C=a+b.len,m=Math.abs(x)<C?Math.sqrt(L*L/(1-x*x/C/C)):C;N.rB=m,N.maxY=L}N.list.push(b)}c(f),c(y)}for(var v=e.length,s=0;s<v;s++)if(e[s].position==="outer"&&e[s].labelAlignTo==="labelLine"){var o=e[s].label.x-d;e[s].linePoints[1][0]+=o,e[s].label.x=d}Fe(e,u,u+n)&&p(e)}function Mt(e,t,r,a,i,l,n,g){for(var u=[],d=[],c=Number.MAX_VALUE,p=-Number.MAX_VALUE,v=0;v<e.length;v++){var s=e[v].label;ie(e[v])||(s.x<t?(c=Math.min(c,s.x),u.push(e[v])):(p=Math.max(p,s.x),d.push(e[v])))}for(var v=0;v<e.length;v++){var o=e[v];if(!ie(o)&&o.linePoints){if(o.labelStyleWidth!=null)continue;var s=o.label,h=o.linePoints,f=void 0;o.labelAlignTo==="edge"?s.x<t?f=h[2][0]-o.labelDistance-n-o.edgeDistance:f=n+i-o.edgeDistance-h[2][0]-o.labelDistance:o.labelAlignTo==="labelLine"?s.x<t?f=c-n-o.bleedMargin:f=n+i-p-o.bleedMargin:s.x<t?f=s.x-n-o.bleedMargin:f=n+i-s.x-o.bleedMargin,o.targetTextWidth=f,Ce(o,f)}}we(d,t,r,a,1,i,l,n,g,p),we(u,t,r,a,-1,i,l,n,g,c);for(var v=0;v<e.length;v++){var o=e[v];if(!ie(o)&&o.linePoints){var s=o.label,h=o.linePoints,y=o.labelAlignTo==="edge",S=s.style.padding,b=S?S[1]+S[3]:0,N=s.style.backgroundColor?0:b,L=o.rect.width+N,x=h[1][0]-h[2][0];y?s.x<t?h[2][0]=n+o.edgeDistance+L+o.labelDistance:h[2][0]=n+i-o.edgeDistance-L-o.labelDistance:(s.x<t?h[2][0]=s.x+o.labelDistance:h[2][0]=s.x-o.labelDistance,h[1][0]=h[2][0]+x),h[1][1]=h[2][1]=s.y}}}function Ce(e,t,r){if(r===void 0&&(r=!1),e.labelStyleWidth==null){var a=e.label,i=a.style,l=e.rect,n=i.backgroundColor,g=i.padding,u=g?g[1]+g[3]:0,d=i.overflow,c=l.width+(n?0:u);if(t<c||r){var p=l.height;if(d&&d.match("break")){a.setStyle("backgroundColor",null),a.setStyle("width",t-u);var v=a.getBoundingRect();a.setStyle("width",Math.ceil(v.width)),a.setStyle("backgroundColor",n)}else{var s=t-u,o=t<c?s:r?s>e.unconstrainedWidth?null:s:null;a.setStyle("width",o)}var h=a.getBoundingRect();l.width=h.width;var f=(a.style.margin||0)+2.1;l.height=h.height+f,l.y-=(l.height-p)/2}}}function ie(e){return e.position==="center"}function Tt(e){var t=e.getData(),r=[],a,i,l=!1,n=(e.get("minShowLabelAngle")||0)*xt,g=t.getLayout("viewRect"),u=t.getLayout("r"),d=g.width,c=g.x,p=g.y,v=g.height;function s(x){x.ignore=!0}function o(x){if(!x.ignore)return!0;for(var C in x.states)if(x.states[C].ignore===!1)return!0;return!1}t.each(function(x){var C=t.getItemGraphicEl(x),m=C.shape,w=C.getTextContent(),O=C.getTextGuideLine(),z=t.getItemModel(x),B=z.getModel("label"),E=B.get("position")||z.get(["emphasis","label","position"]),$=B.get("distanceToLabelLine"),P=B.get("alignTo"),V=R(B.get("edgeDistance"),d),k=B.get("bleedMargin"),I=z.getModel("labelLine"),A=I.get("length");A=R(A,d);var T=I.get("length2");if(T=R(T,d),Math.abs(m.endAngle-m.startAngle)<n){K(w.states,s),w.ignore=!0,O&&(K(O.states,s),O.ignore=!0);return}if(o(w)){var M=(m.startAngle+m.endAngle)/2,D=Math.cos(M),F=Math.sin(M),j,J,se,W;a=m.cx,i=m.cy;var U=E==="inside"||E==="inner";if(E==="center")j=m.cx,J=m.cy,W="center";else{var te=(U?(m.r+m.r0)/2*D:m.r*D)+a,ae=(U?(m.r+m.r0)/2*F:m.r*F)+i;if(j=te+D*3,J=ae+F*3,!U){var oe=te+D*(A+u-m.r),ge=ae+F*(A+u-m.r),ce=oe+(D<0?-1:1)*T,ue=ge;P==="edge"?j=D<0?c+V:c+d-V:j=ce+(D<0?-$:$),J=ue,se=[[te,ae],[oe,ge],[ce,ue]]}W=U?"center":P==="edge"?D>0?"right":"left":D>0?"left":"right"}var q=Math.PI,X=0,H=B.get("rotate");if(Le(H))X=H*(q/180);else if(E==="center")X=0;else if(H==="radial"||H===!0){var Ie=D<0?-M+q:-M;X=Ie}else if(H==="tangential"&&E!=="outside"&&E!=="outer"){var Y=Math.atan2(D,F);Y<0&&(Y=q*2+Y);var Oe=F>0;Oe&&(Y=q+Y),X=Y-q}if(l=!!X,w.x=j,w.y=J,w.rotation=X,w.setStyle({verticalAlign:"middle"}),U){w.setStyle({align:W});var re=w.states.select;re&&(re.x+=w.x,re.y+=w.y)}else{var Z=w.getBoundingRect().clone();Z.applyTransform(w.getComputedTransform());var ve=(w.style.margin||0)+2.1;Z.y-=ve/2,Z.height+=ve,r.push({label:w,labelLine:O,position:E,len:A,len2:T,minTurnAngle:I.get("minTurnAngle"),maxSurfaceAngle:I.get("maxSurfaceAngle"),surfaceNormal:new de(D,F),linePoints:se,textAlign:W,labelDistance:$,labelAlignTo:P,edgeDistance:V,bleedMargin:k,rect:Z,unconstrainedWidth:Z.width,labelStyleWidth:w.style.width})}C.setTextConfig({inside:U})}}),!l&&e.get("avoidLabelOverlap")&&Mt(r,a,i,u,d,v,c,p);for(var h=0;h<r.length;h++){var f=r[h],y=f.label,S=f.labelLine,b=isNaN(y.x)||isNaN(y.y);if(y){y.setStyle({align:f.textAlign}),b&&(K(y.states,s),y.ignore=!0);var N=y.states.select;N&&(N.x+=y.x,N.y+=y.y)}if(S){var L=f.linePoints;b||!L?(K(S.states,s),S.ignore=!0):(Re(L,f.minTurnAngle),ze(L,f.surfaceNormal,f.maxSurfaceAngle),S.setShape({points:L}),y.__hostTarget.textGuideLineConfig={anchor:new de(L[0][0],L[0][1])})}}}var Ct=function(e){le(t,e);function t(r,a,i){var l=e.call(this)||this;l.z2=2;var n=new Ge;return l.setTextContent(n),l.updateData(r,a,i,!0),l}return t.prototype.updateData=function(r,a,i,l){var n=this,g=r.hostModel,u=r.getItemModel(a),d=u.getModel("emphasis"),c=r.getItemLayout(a),p=G(Q(u.getModel("itemStyle"),c,!0),c);if(isNaN(p.startAngle)){n.setShape(p);return}if(l){n.setShape(p);var v=g.getShallow("animationType");g.ecModel.ssr?(ne(n,{scaleX:0,scaleY:0},g,{dataIndex:a,isFrom:!0}),n.originX=p.cx,n.originY=p.cy):v==="scale"?(n.shape.r=c.r0,ne(n,{shape:{r:c.r}},g,a)):i!=null?(n.setShape({startAngle:i,endAngle:i}),ne(n,{shape:{startAngle:c.startAngle,endAngle:c.endAngle}},g,a)):(n.shape.endAngle=c.startAngle,pe(n,{shape:{endAngle:c.endAngle}},g,a))}else $e(n),pe(n,{shape:p},g,a);n.useStyle(r.getItemVisual(a,"style")),Ue(n,u);var s=(c.startAngle+c.endAngle)/2,o=g.get("selectedOffset"),h=Math.cos(s)*o,f=Math.sin(s)*o,y=u.getShallow("cursor");y&&n.attr("cursor",y),this._updateLabel(g,r,a),n.ensureState("emphasis").shape=G({r:c.r+(d.get("scale")&&d.get("scaleSize")||0)},Q(d.getModel("itemStyle"),c)),G(n.ensureState("select"),{x:h,y:f,shape:Q(u.getModel(["select","itemStyle"]),c)}),G(n.ensureState("blur"),{shape:Q(u.getModel(["blur","itemStyle"]),c)});var S=n.getTextGuideLine(),b=n.getTextContent();S&&G(S.ensureState("select"),{x:h,y:f}),G(b.ensureState("select"),{x:h,y:f}),Xe(this,d.get("focus"),d.get("blurScope"),d.get("disabled"))},t.prototype._updateLabel=function(r,a,i){var l=this,n=a.getItemModel(i),g=n.getModel("labelLine"),u=a.getItemVisual(i,"style"),d=u&&u.fill,c=u&&u.opacity;Ye(l,_e(n),{labelFetcher:a.hostModel,labelDataIndex:i,inheritColor:d,defaultOpacity:c,defaultText:r.getFormattedLabel(i,"normal")||a.getName(i)});var p=l.getTextContent();l.setTextConfig({position:null,rotation:null}),p.attr({z2:10});var v=r.get(["label","position"]);if(v!=="outside"&&v!=="outer")l.removeTextGuideLine();else{var s=this.getTextGuideLine();s||(s=new je,this.setTextGuideLine(s)),qe(this,Ze(n),{stroke:d,opacity:He(g.get(["lineStyle","opacity"]),c,1)})}},t}(De),It=function(e){le(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ignoreLabelLineUpdate=!0,r}return t.prototype.render=function(r,a,i,l){var n=r.getData(),g=this._data,u=this.group,d;if(!g&&n.count()>0){for(var c=n.getItemLayout(0),p=1;isNaN(c&&c.startAngle)&&p<n.count();++p)c=n.getItemLayout(p);c&&(d=c.startAngle)}if(this._emptyCircleSector&&u.remove(this._emptyCircleSector),n.count()===0&&r.get("showEmptyCircle")){var v=Te(r),s=new De({shape:G(Me(r,i),v)});s.useStyle(r.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=s,u.add(s)}n.diff(g).add(function(o){var h=new Ct(n,o,d);n.setItemGraphicEl(o,h),u.add(h)}).update(function(o,h){var f=g.getItemGraphicEl(h);f.updateData(n,o,d),f.off("click"),u.add(f),n.setItemGraphicEl(o,f)}).remove(function(o){var h=g.getItemGraphicEl(o);Je(h,r,o)}).execute(),Tt(r),r.get("animationTypeUpdate")!=="expansion"&&(this._data=n)},t.prototype.dispose=function(){},t.prototype.containPoint=function(r,a){var i=a.getData(),l=i.getItemLayout(0);if(l){var n=r[0]-l.cx,g=r[1]-l.cy,u=Math.sqrt(n*n+g*g);return u<=l.r&&u>=l.r0}},t.type="pie",t}(We),Ot=function(){function e(t,r){this._getDataWithEncodedVisual=t,this._getRawData=r}return e.prototype.getAllNames=function(){var t=this._getRawData();return t.mapArray(t.getName)},e.prototype.containName=function(t){var r=this._getRawData();return r.indexOfName(t)>=0},e.prototype.indexOfName=function(t){var r=this._getDataWithEncodedVisual();return r.indexOfName(t)},e.prototype.getItemVisual=function(t,r){var a=this._getDataWithEncodedVisual();return a.getItemVisual(t,r)},e}(),Pt=Ae(),kt=function(e){le(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.init=function(r){e.prototype.init.apply(this,arguments),this.legendVisualProvider=new Ot(me(this.getData,this),me(this.getRawData,this)),this._defaultLabelLine(r)},t.prototype.mergeOption=function(){e.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return vt(this,{coordDimensions:["value"],encodeDefaulter:Ne(Ke,this)})},t.prototype.getDataParams=function(r){var a=this.getData(),i=Pt(a),l=i.seats;if(!l){var n=[];a.each(a.mapDimension("value"),function(u){n.push(u)}),l=i.seats=Qe(n,a.hostModel.get("percentPrecision"))}var g=e.prototype.getDataParams.call(this,r);return g.percent=l[r]||0,g.$vars.push("percent"),g},t.prototype._defaultLabelLine=function(r){et(r,"labelLine",["show"]);var a=r.labelLine,i=r.emphasis.labelLine;a.show=a.show&&r.label.show,i.show=i.show&&r.emphasis.label.show},t.type="series.pie",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(tt);function Et(e){return{seriesType:e,reset:function(t,r){var a=t.getData();a.filterSelf(function(i){var l=a.mapDimension("value"),n=a.get(l,i);return!(Le(n)&&!isNaN(n)&&n<0)})}}}function Bt(e){e.registerChartView(It),e.registerSeriesModel(kt),at("pie",e.registerAction),e.registerLayout(Ne(Dt,"pie")),e.registerProcessor(Nt("pie")),e.registerProcessor(Et("pie"))}function Vt(e){var t;if((t=e==null?void 0:e.isNested)!=null&&t.show){const r={name:e.isNested.firstSecond.name,type:"pie",radius:[0,70],minShowLabelAngle:1,selectedMode:"single",encode:{itemName:e.isNested.firstSecond.itemName,value:e.isNested.firstSecond.value},label:{color:"#00FFF7"},labelLine:{show:!0,length:4}},a={name:e.isNested.seriesSecond.name,type:"pie",radius:[90,150],minShowLabelAngle:1,selectedMode:"single",encode:{itemName:e.isNested.seriesSecond.itemName,value:e.isNested.seriesSecond.value},label:{color:_.$fontColor||_.fontColor},labelLine:{show:!0,length:4}};return[r,a]}else return[{name:"",type:"pie",selectedMode:"single",data:[],radius:["0%","60%"],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0}},label:{overflow:"breakAll",color:_.$fontColor||_.fontColor,textStyle:{color:_.$fontColor||_.fontColor,fontSize:16},formatter:function(r){return r.name+`
`+r.percent+"%"}},labelLine:{show:!0,length:15,length2:5,smooth:!0,minTurnAngle:135},center:["50%","50%"]}]}class Rt{constructor(t){he(this,"option");this.option={toolbox:it(t),title:{text:""},tooltip:{trigger:"item",formatter:function(r){return`${r.marker}${r.name}: ${r.value} (${t.unit||"h"})`}},legend:{show:t.showLegend,bottom:0},dataset:{dimensions:[],source:[]},series:Vt(t)}}}function zt(e){var i;const{data:t=null}=e,r=new Rt(e.params).option,a=rt({},r,e.options);if(e.params.dataset&&t.length>1&&(a.dataset.source=t.reverse(),a.dataset.dimensions=Object.keys(t[0])),t){const l=((i=a.series)==null?void 0:i.length)||0;l===1&&(a.series[0].data=t),l>1&&nt(t)&&a.series.forEach((n,g)=>{n[g]=t[g]})}return a}const Ft=["id"],Gt=ht({__name:"index",props:{id:{type:String,default:null},height:{type:String,default:"500px"},width:{type:String,default:"100%"},showCheckbox:{type:Boolean,default:!0},showTips:{type:Boolean,default:!0},className:{type:String,default:null},options:{type:Object,default:()=>({})},data:{type:Array,default:()=>[]},params:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:lt,setup(e,{emit:t}){st([Bt]);const r=t,a=e,i=ft(()=>zt(a)),l=dt(null),{chart:n}=ot(l,i.value,a.data,r,a.loading);function g(c){ut(i.value,c),n.value.setOption(i.value)}pt(()=>{n.value.setOption(i.value)});const{getPrefixCls:u}=gt(),d=u("pie");return(c,p)=>(mt(),yt("div",{class:be([`${wt(d)}`])},[bt(ct,{showTips:e.showTips,showCheckbox:e.showCheckbox,onSetShowLabel:g,style:ye({width:e.width})},null,8,["showTips","showCheckbox","style"]),St("div",{id:e.id,class:be(e.className),style:ye({height:e.height,width:e.width}),ref_key:"pieChartRef",ref:l},null,14,Ft)],2))}}),$t=At(Gt,[["__scopeId","data-v-20883975"]]),Zt=Lt($t);export{Zt as v};
